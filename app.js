function BasicButton(t){const e=this;e.ui=RectangleShape({width:t.width,height:t.height,fill:t.dark?"black":"white",stroke:t.dark?"white":"black",strokeWidth:5,cornerRadius:5}),t.disable||e.ui.setInteractive(!0),t.primary&&(e.ui.strokeWidth=10);Label({text:t.text,fontSize:25,fontWeight:800,fill:t.dark?"white":"black"}).addChildTo(e.ui)}function Card(t,e,i){function n(){o.sprite.setImage(o.img),o.ui.titleLabel.text=o.title,o.ui.descriptionLabel.text=o.description,o.ui.attackLabel.text=o.attack,o.ui.defenseLabel.text=o.defense,0===o.attack?o.ui.attackBox.hide():o.ui.attackBox.show(),0===o.defense?o.ui.defenseBox.hide():o.ui.defenseBox.show()}function a(t){if("00"===t?(o.title="トビ",o.img="card-00",o.description="",o.attack=0,o.defense=1,o.skill=null):"01"===t?(o.title="オシツブシ",o.img="card-01",o.description="",o.attack=0,o.defense=1,o.skill=null):"02"===t?(o.title="サバキ",o.img="card-02",o.description="",o.attack=0,o.defense=1,o.skill=null):"03"===t?(o.title="ハイ",o.img="card-03",o.description="",o.attack=0,o.defense=1,o.skill=null):"04"===t?(o.title="ブツカリ",o.img="card-04",o.description="",o.attack=0,o.defense=1,o.skill=null):"05"===t?(o.title="ハネ返し",o.img="card-05",o.description="",o.attack=0,o.defense=1,o.skill=null):"06"===t?(o.title="シノギ",o.img="card-06",o.description="",o.attack=0,o.defense=1,o.skill=null):"07"===t?(o.title="コスミ",o.img="card-07",o.description="",o.attack=1,o.defense=1,o.skill=null):"10"===t?(o.title="スベリ",o.img="card-10",o.description="",o.attack=1,o.defense=0,o.skill=null):"11"===t?(o.title="キリ",o.img="card-11",o.description="",o.attack=1,o.defense=0,o.skill=null):"12"===t?(o.title="眼を取る",o.img="card-12",o.description="",o.attack=1,o.defense=0,o.skill=null):"13"===t?(o.title="頭を叩く",o.img="card-13",o.description="",o.attack=1,o.defense=0,o.skill=null):"14"===t?(o.title="エグリ",o.img="card-14",o.description="",o.attack=1,o.defense=0,o.skill=null):"15"===t?(o.title="ハネ",o.img="card-15",o.description="",o.attack=1,o.defense=0,o.skill=null):"16"===t?(o.title="シボリ",o.img="card-16",o.description="",o.attack=1,o.defense=0,o.skill=null):"17"===t?(o.title="ホウリコミ",o.img="card-17",o.description="",o.attack=1,o.defense=0,o.skill=null):"20"===t?(o.title="フリカワリ",o.img="card-20",o.description="",o.attack=1,o.defense=1,o.skill=null):"21"===t?(o.title="打ち込み",o.img="card-21",o.description="",o.attack=2,o.defense=0,o.skill=null):"22"===t?(o.title="両ニラミ",o.img="card-22",o.description="",o.attack=1,o.defense=1,o.skill=null):"23"===t?(o.title="石塔シボリ",o.img="card-23",o.description="",o.attack=1,o.defense=1,o.skill=null):"24"===t?(o.title="二段バネ",o.img="card-24",o.description="",o.attack=2,o.defense=0,o.skill=null):"25"===t?(o.title="捨てる",o.img="card-25",o.description="場にあるカード（このカードも含む）を捨て札に移動。ターンは継続する。",o.attack=0,o.defense=0,o.skill="場札クリア"):"26"===t?(o.title="根拠を奪う",o.img="card-26",o.description="",o.attack=2,o.defense=0,o.skill=null):"27"===t?(o.title="薄みを\nとがめる",o.img="card-27",o.description="",o.attack=2,o.defense=0,o.skill=null):"30"===t?(o.title="急所を突く",o.img="card-30",o.description="",o.attack=3,o.defense=0,o.skill=null):"31"===t?(o.title="秀策の\nコスミ",o.img="card-31",o.description="",o.attack=2,o.defense=2,o.skill=null):"32"===t?(o.title="鉄柱",o.img="card-32",o.description="",o.attack=0,o.defense=3,o.skill=null):"33"===t?(o.title="村正の妖刀",o.img="card-33",o.point=6,o.description="カードを引くたびに攻撃力が変化（１～６））。",o.attack=1,o.defense=0,o.skill="攻撃力ランダム"):"34"===t?(o.title="手抜き",o.img="card-34",o.point=1,o.description="カードを引いた時に、HPが"+o.point+"回復。",o.attack=2,o.defense=-2,o.skill="ドロー回復"):"35"===t?(o.title="定石外れ",o.img="card-35",o.point=4,o.description="カードを引くたびに攻撃力が変化（１～４）。",o.attack=1,o.defense=-3,o.skill="攻撃力ランダム"):"36"===t?(o.title="石の下",o.img="card-36",o.point=2,o.description="HPが"+o.point+"回復。",o.attack=1,o.defense=2,o.skill="回復"):"37"===t?(o.title="鬼手",o.img="card-37",o.description="敵の防御力を無視して攻撃。",o.attack=5,o.defense=0,o.skill="貫通"):"38"===t?(o.title="耳赤の妙手",o.img="card-38",o.description="敵の防御力を無視して攻撃。",o.attack=4,o.defense=4,o.skill="貫通"):"40"===t?(o.title="休憩",o.img="card-40",o.point=1,o.description="HPが"+o.point+"回復。",o.attack=0,o.defense=0,o.skill="回復"):"41"===t?(o.title="諦めない心",o.img="card-41",o.point=2,o.description="カードを引いた時に、HPが"+o.point+"回復。",o.attack=0,o.defense=0,o.skill="ドロー回復"):"50"===t?(o.title="迫力",o.img="card-50",o.description="このターンに限り、すべてのカードの攻撃力が２倍。",o.attack=0,o.defense=0,o.skill="攻撃力２倍"):"51"===t?(o.title="厚み",o.img="card-51",o.description="このターンに限り、すべてのカードの攻撃力と防御力が２倍。",o.attack=1,o.defense=1,o.skill="攻撃力防御力２倍"):"52"===t?(o.title="流れを\n変える",o.img="card-52",o.description="全ての捨て札を山札に戻し、山札をシャッフル。",o.attack=0,o.defense=2,o.skill="シャッフル"):"53"===t?(o.title="長考",o.img="card-53",o.description="（合成専用）",o.attack=0,o.defense=0,o.skill=""):"54"===t?(o.title="形勢判断",o.img="card-54",o.description="（合成専用）",o.attack=0,o.defense=0,o.skill=""):"55"===t?(o.title="捨て石",o.img="card-55",o.description="（合成専用）",o.attack=0,o.defense=0,o.skill=""):"56"===t?(o.title="魔手",o.img="card-56",o.description="全ての捨て札を山札に戻し、山札を攻撃力の高い順に並べ替える。",o.attack=0,o.defense=4,o.skill="攻撃力ソート"):"57"===t?(o.title="化ける",o.img="card-57",o.description="山札から１枚を選んで場に出せる。このカードは破棄される。",o.attack=0,o.defense=0,o.skill="リクルート"):"58"===t?(o.title="天下コウ",o.img="card-58",o.description="敵が１ターン行動不能になる。",o.attack=0,o.defense=0,o.skill="威嚇"):"90"===t?(o.title="アキ三角",o.img="card-90",o.point=1,o.description="カードを引くたびに"+o.point+"のダメージ。",o.attack=0,o.defense=0,o.skill="自ダメージ",o.bad=!0):"91"===t?(o.title="ダメ詰まり",o.img="card-91",o.point=2,o.description="カードを引くたびに"+o.point+"のダメージ。",o.attack=0,o.defense=0,o.skill="自ダメージ",o.bad=!0):"92"===t&&(o.title="サカレ形",o.img="card-92",o.point=3,o.description="カードを引くたびに"+o.point+"のダメージ。",o.attack=0,o.defense=0,o.skill="自ダメージ",o.bad=!0),!o.title)throw"カードID不正: id="+t}const o=this;o.status="stock",o.id=t,o.title="",o.img="",o.description="",o.rawID=i||Math.random();let s=130,r=195,l=20,c=8,d=.5,h=-65,u=-18,f=50,p=.5,m=70;e&&(s*=2,r*=2,l*=2,c=2*c+2,d=1,u*=2,h*=2,f*=2,p*=2),a(o.id),o.ui=RectangleShape({width:s,height:r,fill:o.bad?"RebeccaPurple":"WhiteSmoke",stroke:"black",strokeWidth:5,cornerRadius:5,shadow:"black",shadowBlur:15}),o.backupAttack=o.attack,o.backupDefense=o.defense,o.sprite=Sprite(o.img).addChildTo(o.ui).setPosition(0,u).setScale(d),o.ui.titleLabel=LabelArea({text:o.title,fontSize:l,fontWeight:800,width:s-20,height:2*l,align:"center",stroke:"white",strokeWidth:5}).addChildTo(o.ui).setPosition(0,h),o.ui.descriptionLabel=LabelArea({text:o.description,fontSize:c,width:s-20,height:6*c,fill:o.bad?"white":"black"}).addChildTo(o.ui).setPosition(0,f),o.ui.attackBox=CircleShape({radius:50,fill:"firebrick",strokeWidth:5,stroke:"black"}).setScale(p).addChildTo(o.ui).setPosition(-1*s/2+p/2+20,r/2-p/2-20),o.ui.attackLabel=Label({text:o.attack,fontSize:m,fill:"white",fontWeight:800,stroke:"black",strokeWidth:5}).addChildTo(o.ui.attackBox).setPosition(0,0),o.ui.defenseBox=CircleShape({radius:50,fill:"blue",strokeWidth:5,stroke:"black"}).setScale(p).addChildTo(o.ui).setPosition(s/2-p/2-20,r/2-p/2-20),o.ui.defenseLabel=Label({text:o.defense,fontSize:m,fill:"white",fontWeight:800,stroke:"black",strokeWidth:5}).addChildTo(o.ui.defenseBox).setPosition(0,0),n(),o.change=function(t,e){o.id=t,a(o.id),n(),o.rawID=e||Math.random()},o.attackUp=function(t){0!==o.attack&&(o.attack+=t,o.ui.attackBox.setScale(2).tweener.wait(100).call(function(){o.ui.attackLabel.text=o.attack}).to({scaleX:.5,scaleY:.5},300).play())},o.defenseUp=function(t){0!==o.defense&&(o.defense+=t,o.ui.defenseBox.setScale(2).tweener.wait(100).call(function(){o.ui.defenseLabel.text=o.defense}).to({scaleX:.5,scaleY:.5},300).play())},o.reset=function(){o.backupAttack>0&&(o.attack=o.backupAttack,o.ui.attackLabel.text=o.attack),o.backupDefense>0&&(o.defense=o.backupDefense,o.ui.defenseLabel.text=o.defense)}}function Cards(){const t=this,e=[];t.list=e,t.createNewCards=function(){t.add(new Card("00")),t.add(new Card("01")),t.add(new Card("02")),t.add(new Card("03")),t.add(new Card("04")),t.add(new Card("05")),t.add(new Card("06")),t.add(new Card("07")),t.add(new Card("10")),t.add(new Card("11")),t.add(new Card("12")),t.add(new Card("13")),t.add(new Card("14")),t.add(new Card("15")),t.add(new Card("16")),t.add(new Card("17")),t.add(new Card("50"))},t.add=function(t){e.push(t)},t.count=function(){return e.length},t.remove=function(t){const i=e.findIndex(function(e){return e.rawID===t});i<0||e.splice(i,1)},t.shuffle=function(){e.sort(()=>Math.random()-.5)}}function CardsUI(t,e){function i(){s.text=n.count()}const n=this;t||(t=new Cards);const a=[];let o;t.list.forEach(function(t){a.push(new Card(t.id))}),n.list=a,n.ui=RectangleShape({width:84,height:104,fill:"rgba(0,0,0,0.5)",stroke:0}),o=e?Sprite("discard").addChildTo(n.ui).setPosition(0,10):Sprite("stock").addChildTo(n.ui).setPosition(0,10),n.ui.setInteractive(!0),n.ui.on("pointstart",function(){if(waiting)return;const t={};t.list=a,App.pushScene(CardsListScene({cards:t}))});const s=Label({text:"0",fill:"white",fontSize:20}).addChildTo(n.ui).setPosition(0,-35);n.add=function(t){a.push(new Card(t.id,!1,t.rawID)),i()},n.addRandom=function(t){const e=new Card(t.id,!1,t.rawID);a.splice(Math.floor(Math.random()*(a.length+1)),0,e)},n.count=function(){return a.length},n.deal=function(){if(0===n.count())return null;const t=a.shift();return i(),new Card(t.id,!1,t.rawID)},n.clear=function(){const t=a.map(t=>t);return a=[],t},n.remove=function(t){const e=a.findIndex(function(e){return e.rawID===t});e<0||(a.splice(e,1),i())},n.shuffle=function(){for(let t=0;t<5;t++)a.sort(()=>Math.random()-.5);for(let t=a.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[a[t],a[e]]=[a[e],a[t]]}},n.sortByAttack=function(){a.sort((t,e)=>e.attack-t.attack)},i()}function Enemy(t){const e=this;let i=-1;switch(e.skipTurn=!1,e.turnBegin=function(){e.defense=e.defaultDefense},e.turnEnd=function(){i+=1,e.actions.length-1<i&&(i=0)},e.getAction=function(){return e.actions[i]},t){case"01":e.hp=4,e.defense=0,e.defaultDefense=0,e.img="monster01",e.actions=[[{name:"attack",point:1}],[{name:"life",point:1}]];break;case"02":e.hp=3,e.defense=0,e.defaultDefense=0,e.img="monster02",e.actions=[[{name:"attack",point:1}],[{name:"attack",point:1},{name:"defense",point:1}],[{name:"life",point:2}]];break;case"03":e.hp=3,e.defense=2,e.defaultDefense=0,e.img="monster03",e.actions=[[{name:"defense",point:2}],[{name:"defense",point:2}],[{name:"attack",point:3}]];break;case"04":e.hp=5,e.defense=0,e.defaultDefense=0,e.img="monster04",e.actions=[[{name:"attack",point:2}]];break;case"05":e.hp=3,e.defense=2,e.defaultDefense=0,e.img="monster05",e.actions=[[{name:"defense",point:2},{name:"card",point:"90"}],[{name:"attack",point:2},{name:"defense",point:2}],[{name:"defense",point:2}]];break;case"06":e.hp=5,e.defense=0,e.defaultDefense=0,e.img="monster06",e.actions=[[{name:"attack",point:3}]];break;case"07":e.hp=5,e.defense=2,e.defaultDefense=0,e.img="monster07",e.actions=[[{name:"card",point:"91"}],[{name:"attack",point:2},{name:"defense",point:1}],[{name:"attack",point:1},{name:"defense",point:2}],[{name:"attack",point:2}]];break;case"08":e.hp=6,e.defense=0,e.defaultDefense=0,e.img="monster08",e.actions=[[{name:"attack",point:3},{name:"defense",point:1}],[{name:"defense",point:1}]];break;case"09":e.hp=4,e.defense=2,e.defaultDefense=0,e.img="monster09",e.actions=[[{name:"card",point:"92"},{name:"defense",point:2}],[{name:"attack",point:3}],[{name:"defense",point:2}]];break;case"10":e.hp=7,e.defense=0,e.defaultDefense=0,e.img="monster10",e.actions=[[{name:"attack",point:3}],[{name:"defense",point:3}]];break;case"11":e.hp=6,e.defense=1,e.defaultDefense=0,e.img="monster11",e.actions=[[{name:"attack",point:2},{name:"defense",point:1}],[{name:"attack",point:2},{name:"life",point:1},{name:"card",point:"91"}]];break;case"12":e.hp=5,e.defense=0,e.defaultDefense=0,e.img="monster12",e.actions=[[{name:"attack",point:4}],[{name:"life",point:3}]];break;case"13":e.hp=5,e.defense=0,e.defaultDefense=0,e.img="monster13",e.actions=[[{name:"defense",point:2}],[{name:"defense",point:3}],[{name:"defense",point:4}],[{name:"attack",point:5}]];break;case"14":e.hp=7,e.defense=4,e.defaultDefense=0,e.img="monster14",e.actions=[[{name:"attack",point:3},{name:"defense",point:1}],[{name:"life",point:2},{name:"attack",point:2}]];break;case"15":e.hp=8,e.defense=0,e.defaultDefense=0,e.img="monster15",e.actions=[[{name:"attack",point:3},{name:"card",point:"91"}],[{name:"life",point:2},{name:"defense",point:2}],[{name:"attack",point:3}]];break;case"16":e.hp=9,e.defense=1,e.defaultDefense=0,e.img="monster16",e.actions=[[{name:"attack",point:1},{name:"defense",point:1},{name:"life",point:1}],[{name:"attack",point:2}]];break;case"17":e.hp=8,e.defense=0,e.defaultDefense=0,e.img="monster17",e.actions=[[{name:"attack",point:1},{name:"defense",point:2}],[{name:"attack",point:1},{name:"card",point:"92"},{name:"defense",point:2}],[{name:"attack",point:2}]];break;case"99":e.hp=20,e.defense=10,e.defaultDefense=0,e.img="monster99",e.actions=[[{name:"card",point:"90"},{name:"card",point:"91"},{name:"card",point:"92"}],[{name:"attack",point:1},{name:"defense",point:1}],[{name:"attack",point:2},{name:"defense",point:2}],[{name:"attack",point:3},{name:"defense",point:3}],[{name:"attack",point:4},{name:"defense",point:4}],[{name:"defense",point:3},{name:"life",point:3}],[{name:"defense",point:3},{name:"life",point:3}],[{name:"defense",point:3},{name:"life",point:3}]]}}function Player(t){const e=this;e.hp=10,e.maxHp=10,e.defense=0,e.defaultDefense=0,e.stone=0,t&&t.hp&&(e.hp=t.hp),t&&t.maxHp&&(e.maxHp=t.maxHp),t&&t.defense&&(e.defense=t.defense),t&&t.defaultDefense&&(e.defaultDefense=t.defaultDefense),t&&t.stone&&(e.stone=t.stone),e.turnBegin=function(){e.defense=e.defaultDefense}}function Storage(){const t=this;t._export=function(){return JSON.stringify({version:version,player:player,mapIndex:mapIndex,cards:myCards.list.map(t=>t.id)})},t.save=function(){const e=t._export();e&&localStorage.setItem("card",e)},t.load=function(){const t=localStorage.getItem("card");if(!t)return;const e=JSON.parse(t);e.takeOver&&e.takeOver.cardID?myCards.add(new Card(e.takeOver.cardID)):(player=new Player(e.player),mapIndex=e.mapIndex,myCards=new Cards,e.cards.forEach(t=>myCards.add(new Card(t))))},t.remove=function(){localStorage.clear("card")}}phina.globalize();const version="1.3";let player,myCards,mapIndex=0,waiting=!1;const ASSETS={image:{story:"img/story.jpeg",stock:"img/stock.png",discard:"img/discard.png","card-00":"img/card-00.png","card-01":"img/card-01.png","card-02":"img/card-02.png","card-03":"img/card-03.png","card-04":"img/card-04.png","card-05":"img/card-05.png","card-06":"img/card-06.png","card-07":"img/card-07.png","card-10":"img/card-10.png","card-11":"img/card-11.png","card-12":"img/card-12.png","card-13":"img/card-13.png","card-14":"img/card-14.png","card-15":"img/card-15.png","card-16":"img/card-16.png","card-17":"img/card-17.png","card-20":"img/card-20.png","card-21":"img/card-21.png","card-22":"img/card-22.png","card-23":"img/card-23.png","card-24":"img/card-24.png","card-25":"img/card-25.png","card-26":"img/card-26.png","card-27":"img/card-27.png","card-30":"img/card-30.png","card-31":"img/card-31.png","card-32":"img/card-32.png","card-33":"img/card-33.png","card-34":"img/card-34.png","card-35":"img/card-35.png","card-36":"img/card-36.png","card-37":"img/card-37.png","card-38":"img/card-38.png","card-40":"img/card-40.png","card-41":"img/card-41.png","card-50":"img/card-50.png","card-51":"img/card-51.png","card-52":"img/card-52.png","card-53":"img/card-53.png","card-54":"img/card-54.png","card-55":"img/card-55.png","card-56":"img/card-56.png","card-57":"img/card-57.png","card-58":"img/card-58.png","card-90":"img/card-90.png","card-91":"img/card-91.png","card-92":"img/card-92.png",defense:"img/defense.png",life:"img/life.png",monster01:"img/monster01.png",monster02:"img/monster02.png",monster03:"img/monster03.png",monster04:"img/monster04.png",monster05:"img/monster05.png",monster06:"img/monster06.png",monster07:"img/monster07.png",monster08:"img/monster08.png",monster09:"img/monster09.png",monster10:"img/monster10.png",monster11:"img/monster11.png",monster12:"img/monster12.png",monster13:"img/monster13.png",monster14:"img/monster14.png",monster15:"img/monster15.png",monster16:"img/monster16.png",monster17:"img/monster17.png",monster99:"img/monster99.png",dungeon01:"img/dungeon01.jpeg",dungeon02:"img/dungeon02.jpeg",dungeon09:"img/dungeon09.jpeg",effect1:"img/effect1.jpeg",close:"img/close.png",npc1:"img/npc1.jpeg",lock:"img/lock.png"}};phina.main(function(){App=GameApp({assets:ASSETS,startLabel:"TitleScene",scenes:[{label:"TitleScene",className:"TitleScene"},{label:"IntroScene",className:"IntroScene"},{label:"MainScene",className:"MainScene"},{label:"BattleScene",className:"BattleScene"},{label:"GetItemScene",className:"GetItemScene"},{label:"CardPlusScene",className:"CardPlusScene"},{label:"CardPresenterScene",className:"CardPresenterScene"},{label:"ResultScene",className:"ResultScene"}]}),App.fps=60,App.run()}),phina.define("Scrollable",{superClass:"phina.accessory.Accessory",scrollType:"normal",vx:0,vy:0,minX:-1/0,minY:-1/0,maxX:1/0,maxY:1/0,_locked:!1,init:function(t){this.superInit(t),this.friction=.8,this.on("attached",this._attached)},lock:function(){return this._locked=!0,this.vx=this.vy=0,this},unlock:function(){return this._locked=!1,this},setFriction:function(t){return this.friction=t,this},setScrollType:function(t){return this.scrollType=t,this},setMaxX:function(t){return this.maxX=t,this},setMinX:function(t){return this.minX=t,this},setMaxY:function(t){return this.maxY=t,this},setMinY:function(t){return this.minY=t,this},setMaxPosition:function(t,e){return this.maxX=t,this.maxY=e,this},setMinPosition:function(t,e){return this.minX=t,this.minY=e,this},enableClip:function(){return this.target.clip=function(t){var e=this.width,i=this.height;t.beginPath().rect(-e*this.originX,-i*this.originY,e,i)},this},disableClip:function(){return this.target.clip=null,this},_attached:function(t){var e=this.target;e.setInteractive(!0),this._setPointstart(),this._setPointmove(),this._setPointend(),this._setEnterframe()},_setPointstart:function(){var t=this;this.target.on("pointstart",function(e){t.pointing=!0})},_setPointmove:function(){var t=this;this.target.on("pointmove",function(e){t._locked||t.getScrollMethod().move.call(this,e,t)})},_setPointend:function(){var t=this;this.target.on("pointend",function(e){t.pointing=!1,t._locked||(t.vx=e.pointer.fx,t.vy=e.pointer.fy)})},_setEnterframe:function(){var t=this;this.target.on("enterframe",function(e){t._locked||!1===t.pointing&&t.getScrollMethod().update(t)},this)},getScrollMethod:function(){return Scrollable.SCROLL_METHOD_MAP[this.scrollType]||Scrollable.SCROLL_METHOD_MAP.normal},_static:{SCROLL_METHOD_MAP:{x:{move:function(t,e){var i=t.pointer.dx,n=e.maxX,a=e.minX;this.children.forEach(function(t){t.x+=i,t.x>n&&(t.x=n),t.x<a&&(t.x=a)})},update:function(t){var e=t.target;t.vx*=t.friction,Math.abs(t.vx)<1&&(t.vx=0);var i=t.vx,n=t.maxX,a=t.minX;e.children.forEach(function(t){t.x+=i,t.x>n&&(t.x=n),t.x<a&&(t.x=a)})}},y:{move:function(t,e){var i=t.pointer.dy,n=e.maxY,a=e.minY;this.children.forEach(function(t){t.y+=i,t.y>n&&(t.y=n),t.y<a&&(t.y=a)})},update:function(t){var e=t.target;t.vy*=t.friction,Math.abs(t.vy)<1&&(t.vy=0);var i=t.vy,n=t.maxY,a=t.minY;e.children.forEach(function(t){t.y+=i,t.y>n&&(t.y=n),t.y<a&&(t.y=a)})}},normal:{move:function(t,e){var i=t.pointer,n=Math.abs(i.dx)<Math.abs(i.dy)?"y":"x",a=i["d"+n],o=e["max"+n.toUpperCase()],s=e["min"+n.toUpperCase()];this.children.forEach(function(t){t[n]+=a,t[n]>o&&(t[n]=o),t[n]<s&&(t[n]=s)})},update:function(t){var e=Math.abs(t.vx)<Math.abs(t.vy)?"y":"x",i="v"+e,n=t.target;t[i]*=t.friction,Math.abs(t[i])<1&&(t[i]=0);var a=t[i],o=t["max"+e.toUpperCase()],s=t["min"+e.toUpperCase()];n.children.forEach(function(t){t[e]+=a,t[e]>o&&(t[e]=o),t[e]<s&&(t[e]=s)}),t.vx=t.vy=0,t[i]=a}},flick:{move:function(t,e){var i={x:t.pointer.dx,y:t.pointer.dy},n=e.maxX,a=e.maxY,o=e.minX,s=e.minY;this.children.forEach(function(t){t.position.add(i),t.x>n&&(t.x=n),t.x<o&&(t.x=o),t.y>a&&(t.y=a),t.y<s&&(t.y=s)})},update:function(t){var e=t.target;t.vx*=t.friction,t.vy*=t.friction,Math.abs(t.vx)<1&&(t.vx=0),Math.abs(t.vy)<1&&(t.vy=0);var i={x:t.vx,y:t.vy},n=t.maxX,a=t.maxY,o=t.minX,s=t.minY;e.children.forEach(function(t){t.position.add(i),t.x>n&&(t.x=n),t.x<o&&(t.x=o),t.y>a&&(t.y=a),t.y<s&&(t.y=s)})}}}}}),phina.define("BattleScene",{superClass:"DisplayScene",init:function(t){function e(){A.text=t.player.defense,t.player.hp<0&&(t.player.hp=0),t.player.hp>t.player.maxHp&&(t.player.hp=t.player.maxHp),R.text=t.player.hp}function i(){t.enemy.defense<0&&(t.enemy.defense=0),_.text=t.enemy.defense,t.enemy.hp<0&&(t.enemy.hp=0),F.text=t.enemy.hp}function n(t){for(let e=0;e<3;e++){if(null!==L.enemyActions[e]&&(L.enemyActions[e].remove(),L.enemyActions[e]=null),!t[e])continue;let i="";if("attack"===t[e].name)i="firebrick";else if("defense"===t[e].name)i="blue";else if("life"===t[e].name)i="deeppink";else{if("card"!==t[e].name)continue;i="purple"}"life"===t[e].name?L.enemyActions[e]=HeartShape({radius:50,fill:i,strokeWidth:5,stroke:"black"}):"card"===t[e].name?L.enemyActions[e]=RectangleShape({width:80,height:100,fill:i,strokeWidth:5,stroke:"black"}):L.enemyActions[e]=CircleShape({radius:50,fill:i,strokeWidth:5,stroke:"black"}),L.enemyActions[e].addChildTo(L).setPosition(L.enemyStatusBox.x-150+52*e,L.enemyStatusBox.y+40).setScale(.5);const n=Label({text:"",fontSize:70,fontWeight:800,fill:"white",stroke:"black",strokeWidth:5}).addChildTo(L.enemyActions[e]);"card"===t[e].name?(n.text="?",L.enemyActions[e].setInteractive(!0),L.enemyActions[e].on("pointstart",function(){const i=t[e].point;App.pushScene(CardDetailScene({cardID:i}))})):n.text=t[e].point}}function a(e){const i=t.enemy.getAction()[e];return Flow(function(t){i?("attack"===i.name&&o(L.enemyActions[e],i.point).then(function(){t()}),"defense"===i.name&&s(L.enemyActions[e],i.point).then(function(){t()}),"life"===i.name&&r(L.enemyActions[e],i.point).then(function(){t()}),"card"===i.name&&l(L.enemyActions[e],i.point).then(function(){t()})):t()})}function o(i,n){return Flow(function(a){const o=CircleShape({radius:150,fill:"firebrick",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:n,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(o),o.setPosition(i.x,i.y).tweener.call(function(){i.remove()}).to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.myStatusBox.x,y:L.myStatusBox.y,scaleX:.01,scaleY:.01},200,"easeInQuart").call(function(){L.myStatusBox.tweener.by({y:-20},30).by({y:20},50).call(function(){let i=n;if(t.player.defense>0){i-=t.player.defense;let e=t.player.defense;n>t.player.defense?t.player.defense=0:t.player.defense-=n;const a=Label({text:t.player.defense-e,fontSize:30,fontWeight:800,fill:"firebrick",stroke:"white",strokeWidth:3});a.addChildTo(L).setPosition(L.myStatusBox.x,L.myStatusBox.y-30).tweener.by({y:-20,alpha:-1},1e3).call(function(){a.remove()}).play()}if(i>0){t.player.hp-=i;const e=Label({text:"-"+i,fontSize:30,fontWeight:800,fill:"firebrick",stroke:"white",strokeWidth:3});e.addChildTo(L).setPosition(L.myStatusBox.x,L.myStatusBox.y+30).tweener.by({y:-20,alpha:-1},1e3).call(function(){e.remove()}).play()}e()}).wait(700).call(function(){o.remove(),i.remove(),a()}).play()}).play()})}function s(e,n){return Flow(function(a){const o=CircleShape({radius:150,fill:"blue",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:n,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(o),o.setPosition(e.x,e.y).tweener.call(function(){e.remove()}).to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.enemyStatusBox.x,y:L.enemyStatusBox.y,scaleX:.01,scaleY:.01},200,"easeOutQuart").call(function(){const e=Label({text:"+"+n,fontSize:30,fontWeight:800,fill:"blue",stroke:"white",strokeWidth:3});e.addChildTo(L).setPosition(L.enemyStatusBox.x,L.enemyStatusBox.y-20).tweener.by({y:-20,alpha:-1},1e3).call(function(){e.remove()}).play(),t.enemy.defense+=n,i()}).wait(700).call(function(){o.remove(),a()}).play()})}function r(e,n){return Flow(function(a){const o=HeartShape({radius:150,fill:"deeppink",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:n,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(o),o.setPosition(e.x,e.y).tweener.call(function(){e.remove()}).to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.enemyStatusBox.x+60,y:L.enemyStatusBox.y,scaleX:.01,scaleY:.01},200,"easeOutQuart").call(function(){const e=Label({text:"+"+n,fontSize:30,fontWeight:800,fill:"blue",stroke:"white",strokeWidth:3});e.addChildTo(L).setPosition(L.enemyStatusBox.x+60,L.enemyStatusBox.y-20).tweener.by({y:-20,alpha:-1},1e3).call(function(){e.remove()}).play(),t.enemy.hp+=n,i()}).wait(700).call(function(){o.remove(),a()}).play()})}function l(t,e){return Flow(function(i){const n=RectangleShape({width:170,height:200,fill:"purple",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:"?",fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(n),n.setPosition(t.x,t.y).tweener.call(function(){t.remove()}).to({scaleX:.4,scaleY:.4},200).wait(200).to({x:H.ui.x,y:H.ui.y,scaleX:.01,scaleY:.01},200,"easeOutQuart").call(function(){const t=Label({text:"+1",fontSize:30,fontWeight:800,fill:"purple",stroke:"white",strokeWidth:3});t.addChildTo(L).setPosition(H.ui.x,H.ui.y-20).tweener.by({y:-20,alpha:-1},1e3).call(function(){t.remove()}).play();const i=new Card(e);H.addRandom(i)}).wait(700).call(function(){n.remove(),i()}).play()})}function c(e){return Flow(function(n){const a=CircleShape({radius:150,fill:"firebrick",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:e.attack,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(a),a.setPosition(e.ui.x+e.ui.attackBox.x,e.ui.y+e.ui.attackBox.y).tweener.to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.enemyStatusBox.x,y:L.enemyStatusBox.y,scaleX:.01,scaleY:.01},200,"easeInQuart").call(function(){L.enemyStatusBox.tweener.by({y:-20},30).by({y:20},50).call(function(){let n=e.attack;if(t.enemy.defense>0&&"貫通"!==e.skill){n-=t.enemy.defense;let i=t.enemy.defense;e.attack>t.enemy.defense?t.enemy.defense=0:t.enemy.defense-=e.attack;const a=Label({text:t.enemy.defense-i,fontSize:30,fontWeight:800,fill:"firebrick",stroke:"white",strokeWidth:3});a.addChildTo(L).setPosition(L.enemyStatusBox.x,L.enemyStatusBox.y-20).tweener.by({y:-20,alpha:-1},1e3).call(function(){a.remove()}).play()}if(n>0){t.enemy.hp-=n;const e=Label({text:"-"+n,fontSize:30,fontWeight:800,fill:"firebrick",stroke:"white",strokeWidth:3});e.addChildTo(L).setPosition(L.enemyStatusBox.x+80,L.enemyStatusBox.y-20).tweener.by({y:-20,alpha:-1},1e3).call(function(){e.remove()}).play()}i()}).wait(700).call(function(){a.remove(),n()}).play()}).play()})}function d(i){return Flow(function(n){const a=CircleShape({radius:150,fill:"blue",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:i.defense,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(a),a.setPosition(i.ui.x+i.ui.defenseBox.x,i.ui.y+i.ui.defenseBox.y).tweener.to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.myStatusBox.x,y:L.myStatusBox.y,scaleX:.01,scaleY:.01},200,"easeInQuart").call(function(){const n=Label({text:(i.defense>0?"+":"")+i.defense,fontSize:30,fontWeight:800,fill:"blue",stroke:"white",strokeWidth:3});n.addChildTo(L).setPosition(L.myStatusBox.x,L.myStatusBox.y-50).tweener.by({y:-20,alpha:-1},1e3).call(function(){n.remove()}).play(),t.player.defense+=i.defense,e()}).wait(700).call(function(){a.remove(),n()}).play()})}function h(i){return Flow(function(n){const a=CircleShape({radius:150,fill:"pink",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:i.point,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(a),a.setPosition(i.ui.x,i.ui.y).tweener.to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.myStatusBox.x,y:L.myStatusBox.y,scaleX:.01,scaleY:.01},200,"easeInQuart").call(function(){const n=Label({text:"+"+i.point,fontSize:30,fontWeight:800,fill:"blue",stroke:"white",strokeWidth:3});n.addChildTo(L).setPosition(L.myStatusBox.x,L.myStatusBox.y+30).tweener.by({y:-20,alpha:-1},1e3).call(function(){n.remove()}).play(),t.player.hp+=i.point,e()}).wait(700).call(function(){a.remove(),n()}).play()})}function u(i,n){return Flow(function(a){const o=CircleShape({radius:150,fill:"firebrick",stroke:"black",strokeWidth:20}).setScale(.1).addChildTo(L);Label({text:n,fontSize:200,fill:"white",fontWeight:800,stroke:"black",strokeWidth:20}).addChildTo(o),o.setPosition(i.ui.x,i.ui.y).tweener.to({scaleX:.4,scaleY:.4},200).wait(200).to({x:L.myStatusBox.x,y:L.myStatusBox.y,scaleX:.01,scaleY:.01},200,"easeInQuart").call(function(){L.myStatusBox.tweener.by({y:-20},30).by({y:20},50).call(function(){t.player.hp-=n;const i=Label({text:"-"+n,fontSize:30,fontWeight:800,fill:"firebrick",stroke:"white",strokeWidth:3});i.addChildTo(L).setPosition(L.myStatusBox.x,L.myStatusBox.y+30).tweener.by({y:-20,alpha:-1},1e3).call(function(){i.remove()}).play(),e()}).wait(700).call(function(){o.remove(),a()}).play()}).play()})}function f(t){return Flow(function(e){t.ui.tweener.wait(100).by({y:-50},100).wait(100).call(function(){Flow(function(t){w(t)}).then(function(){const t=Label({text:"Shuffle",fontSize:20,fontWeight:800,fill:"white",stroke:"black",strokeWidth:3});t.addChildTo(L).setPosition(H.ui.x,H.ui.y-30).tweener.by({y:-40,alpha:0},1200).call(function(){t.remove()}).play(),H.shuffle()})}).by({y:50},100).wait(700).call(function(){e()}).play()})}function p(t){return Flow(function(e){t.ui.tweener.wait(100).by({y:-50},100).wait(100).call(function(){Flow(function(t){w(t)}).then(function(){const t=Label({text:"Sort",fontSize:20,fontWeight:800,fill:"white",stroke:"black",strokeWidth:3});t.addChildTo(L).setPosition(H.ui.x,H.ui.y-30).tweener.by({y:-40,alpha:0},1200).call(function(){t.remove()}).play(),H.sortByAttack()})}).by({y:50},100).wait(700).call(function(){e()}).play()})}function m(){return Flow(function(t){setTimeout(function(){const e=RectangleShape({width:L.width,height:400,fill:"rgba(0,0,0,0.5)",stroke:0}).addChildTo(L).setPosition(L.gridX.center(),L.gridY.center()),i=Label({text:"Enemy Turn",fontSize:80,fontWeight:800,fill:"white"});i.addChildTo(e).setPosition(-500,0),i.tweener.to({x:0},300,"easeInSine").wait(800).to({x:500},300,"easeInSine").call(function(){e.remove(),t()}).play()},500)})}function y(){return Flow(function(t){const e=RectangleShape({width:L.width,height:400,fill:"rgba(255,255,255,0.3)",strokeWidth:0}).addChildTo(L).setPosition(L.gridX.center(),L.gridY.center()),i=Label({text:"Your Turn",fontSize:80,fontWeight:800,fill:"black",stroke:"white",strokeWidth:2});i.addChildTo(e).setPosition(-500,0),i.tweener.to({x:0},300,"easeInSine").wait(800).to({x:500},300,"easeInSine").call(function(){e.remove(),t()}).play()})}function g(){return Flow(function(t){function e(t){t.ui.setInteractive(!0),Draggable.unlock(),t.dragFlg||(t.drag=Draggable().attachTo(t.ui),t.dragFlg=!0,t.initialPosition=t.drag.initialPosition,t.ui.on("dragend",function(e){if("layout"===t.status||"hand"===t.status)if(t.initialPosition.x!==e.target.position.x||t.initialPosition.y!==e.target.position.y){if("layout"===t.status)return t.ui.tweener.to({x:t.initialPosition.x,y:t.initialPosition.y},200).play(),void(L.dropArea.strokeWidth=1);if(t.ui.hitTestElement(L.dropArea)){if(S(t),L.dropArea.strokeWidth=1,null!==L.layoutCards[0]&&null!==L.layoutCards[1]&&(Draggable.lock(),"場札クリア"!==t.skill)){L.dropArea.hide();const t=RectangleShape({width:j.ui.width,height:j.ui.height,fill:"yellow",strokeWidth:0}).hide().addChildTo(j.ui);t.alpha=.8,t.show().tweener.to({alpha:0,width:j.ui.width+50,height:j.ui.height+50},500,"easeOutCirc").to({alpha:.8,width:j.ui.width,height:j.ui.height},100).to({alpha:0,width:j.ui.width+50,height:j.ui.height+50
},500,"easeOutCirc").call(function(){t.remove()}).play()}}else t.ui.tweener.to({x:t.initialPosition.x,y:t.initialPosition.y},200).play()}else App.pushScene(CardDetailScene({card:t,cardID:t.id,cardRawID:t.rawID}))}),t.ui.on("drag",function(e){t.ui.hitTestElement(L.dropArea)?L.dropArea.strokeWidth=5:L.dropArea.strokeWidth=1}))}function i(){return U[0]=H.deal(),U[0]?(e(U[0]),U[0].status="hand",s(U[0],L.gridX.center()-240)):new Promise(t=>t())}function n(){return U[1]=H.deal(),U[1]?(e(U[1]),U[1].status="hand",s(U[1],L.gridX.center()-80)):new Promise(t=>t())}function a(){return U[2]=H.deal(),U[2]?(e(U[2]),U[2].status="hand",s(U[2],L.gridX.center()+80)):new Promise(t=>t())}function o(){return U[3]=H.deal(),U[3]?(e(U[3]),U[3].status="hand",s(U[3],L.gridX.center()+240)):new Promise(t=>t())}function s(t,e){return new Promise(i=>{t.ui.show(),t.ui.addChildTo(L).setPosition(H.ui.x,H.ui.y).setScale(.1),t.ui.tweener.to({x:e,y:L.gridY.center(4.2),scaleX:1,scaleY:1},200).call(function(){i()}).play()})}function r(){(async()=>{await i(),await n(),await a(),await o(),t()})()}H.count()<4?Flow(function(t){w(t)}).then(function(){r()}):r()})}function k(t){return new Promise(function(e){t?(t.reset(),t.ui.tweener.to({x:N.ui.x,y:N.ui.y,scaleX:.1,scaleY:.1},200).call(()=>{N.add(t),t.status="discard",t.ui.hide(),t.ui.setScale(1),e()}).play()):e()})}function x(){for(let t=0;t<4;t++)U[t]&&"hand"===U[t].status&&N.add(U[t]);for(let t=0;t<2;t++)L.layoutCards[t]&&N.add(L.layoutCards[t]);let t=N.count();for(let e=0;e<t;e++){const t=N.deal();t.reset(),H.add(t)}}function w(t){function e(e){const i=N.deal(),n=RectangleShape({width:32,height:64,fill:"white",stroke:"black",strokeWidth:3});n.addChildTo(L).setPosition(N.ui.x,N.ui.y).tweener.to({x:H.ui.x},100).call(function(){n.remove(),H.add(i),e&&t&&t()}).play()}function i(){setTimeout(function(){a!==n-1?(e(),a+=1,i()):e(!0)},50)}const n=N.count();let a=0;n>0&&i(),0===n&&t()}function b(t){let e;if(L.layoutCards[0]){if(L.layoutCards[1])throw"この関数に入る前にチェックすること";e=L.layoutBox2,L.layoutCards[1]=t}else e=L.layoutBox1,L.layoutCards[0]=t;return t.status="layout",Flow(function(i){t.ui.tweener.to({x:e.x,y:e.y},200).call(function(){i()}).play()})}function S(e){null!==L.layoutCards[0]&&null!==L.layoutCards[1]||b(e).then(function(){function i(){if("攻撃力２倍"===e.skill)for(let t=0;t<4;t++)U[t]&&U[t].attackUp(U[t].attack);else if("防御力２倍"===e.skill)for(let t=0;t<4;t++)U[t]&&U[t].defenseUp(U[t].defense);else if("攻撃力防御力２倍"===e.skill)for(let t=0;t<4;t++)U[t]&&U[t].attackUp(U[t].attack>=0?U[t].attack:-1*U[t].attack),U[t]&&U[t].defenseUp(U[t].defense>=0?U[t].defense:-1*U[t].defense);else if("回復"===e.skill)h(e);else if("シャッフル"===e.skill)f(e);else if("攻撃力ソート"===e.skill)p(e);else if("場札クリア"===e.skill)waiting=!0,e.ui.tweener.wait(100).by({y:-50},100).wait(100).by({y:50},100).wait(300).call(function(){X().then(function(){Draggable.unlock(),waiting=!1,L.dropArea.show()})}).play();else if("リクルート"===e.skill)waiting=!0,e.ui.tweener.wait(100).by({y:-50},100).wait(100).by({y:50},100).wait(300).call(function(){waiting=!1,App.pushScene(CardsListScene({cards:H,button1:{text:"決定",callback:function(t){e.ui.tweener.to({scaleX:0,scaleY:0},200).wait(100).call(function(){e.change(t.id)}).to({scaleX:1,scaleY:1},200).call(function(){H.remove(t.rawID),i(e)}).play()}}}))}).play();else if("威嚇"===e.skill){if(t.enemy.skipTurn)return;waiting=!0,t.enemy.skipTurn=!0,e.ui.tweener.wait(100).by({y:-50},100).wait(100).by({y:50},100).wait(300).call(function(){waiting=!1,L.freeze=Sprite("lock").addChildTo(L.enemyStatusBox).setPosition(-90,10),L.freeze.setScale(2),L.freeze.tweener.to({scaleX:1,scaleY:1},500,"easeInCirc").play()}).play()}}i()})}function C(){waiting=!0,j.ui.hide(),I(0).then(function(){T()||I(1).then(function(){T()||(Y(),v())})})}function v(){L.dropArea.hide(),L.layoutBox1.hide(),L.layoutBox2.hide(),m().then(function(){function e(){a(0).then(function(){B()||a(1).then(function(){B()||a(2).then(function(){B()||P()})})})}t.enemy.turnBegin(),i(),t.enemy.skipTurn?L.enemyStatusBox.tweener.by({x:10},50).by({x:-20},50).by({x:20},50).by({x:-20},50).by({x:20},50).by({x:-10},50).wait(50).call(function(){L.freeze.tweener.to({alpha:0},500).call(function(){L.freeze.remove(),P()}).play()}).play():e()})}function T(){return 0===t.enemy.hp&&(waiting=!1,D.tweener.to({alpha:0},10).wait(50).to({alpha:1},10).wait(50).to({alpha:0},10).wait(50).to({alpha:1},10).wait(50).to({alpha:0},10).wait(30).to({alpha:1},10).wait(30).to({alpha:0},10).wait(30).to({alpha:1},10).wait(30).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},10).wait(10).to({alpha:1},10).wait(10).to({alpha:0},300).wait(500).call(function(){const e=RectangleShape({width:L.width,height:L.height,fill:"black"}).addChildTo(L).setPosition(L.gridX.center(),L.gridY.center());e.alpha=0,e.tweener.to({alpha:1},1e3).call(function(){x(),L.exit("GetItemScene",{items:t.items})}).play()}).play(),!0)}function B(){if(0===t.player.hp){x(),waiting=!0;const t=RectangleShape({width:L.width,height:L.height,fill:"darkred"}).addChildTo(L).setPosition(L.gridX.center(),L.gridY.center());return t.alpha=.1,Label({text:"GAME\nOVER",fontSize:150,fontWeight:800,fill:"darkred",stroke:"white",strokeWidth:20}).addChildTo(L).setPosition(L.gridX.center(),L.gridY.center()),L.on("pointstart",function(){L.exit("ResultScene"),waiting=!1}),t.tweener.to({alpha:.8},5e3),!0}return!1}function P(){waiting=!0,t.enemy.skipTurn?(t.enemy.skipTurn=!1,L.freeze.remove()):(t.enemy.turnEnd(),n(t.enemy.getAction())),y().then(function(){function i(t){return t?Flow(function(e){"ドロー回復"===t.skill?t.ui.tweener.by({y:-30},200).call(function(){h(t)}).by({y:30},200).call(function(){e()}).play():"攻撃力ランダム"===t.skill?(t.attackUp(Math.floor(Math.random()*t.point)),e()):"自ダメージ"===t.skill?t.ui.tweener.by({y:-30},200).call(function(){u(t,t.point).then(function(){e()})}).by({y:30},200).play():e()}):Flow(t=>t())}t.player.turnBegin(),e(),g().then(function(){i(U[0]).then(function(){B()||i(U[1]).then(function(){B()||i(U[2]).then(function(){B()||i(U[3]).then(function(){B()||(L.dropArea.show(),L.layoutBox1.show(),L.layoutBox2.show(),j.ui.show(),waiting=!1)})})})})})})}function X(){const t=L.layoutCards[0],e=L.layoutCards[1];return L.layoutCards[0]=null,L.layoutCards[1]=null,Promise.all([k(t),k(e)])}function Y(){for(let t=0;t<4;t++)U[t]&&U[t].reset(),U[t]&&"hand"===U[t].status&&k(U[t]);for(let t=0;t<2;t++){const e=L.layoutCards[t];e&&(e.reset(),k(e),L.layoutCards[t]=null)}}function I(t){return Flow(function(e){function i(t){return new Promise(function(e){t.attack>0?c(t).then(function(){e()}):e()})}function n(t){return new Promise(function(e){0!==t.defense?d(t).then(function(){e()}):e()})}const a=L.layoutCards[t];null!==a?Promise.all([i(a),n(a)]).then(function(){e()}):e()})}function W(){return Flow(function(t){D.tweener.wait(200).to({scaleX:1,scaleY:1,alpha:1},500,"easeInExpo").call(function(){L.myStatusBox.tweener.wait(500).to({x:L.gridX.span(2)},200).call(function(){H.ui.tweener.to({x:L.gridX.center(6)},200).play(),N.ui.tweener.to({x:L.gridX.center(-6)},200).play()}).wait(500).call(function(){t()}).play()}).play()})}this.superInit(t);const L=this;L.backgroundColor="gray",Sprite(t.backImage).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center());const D=Sprite(t.enemy.img).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center()).setScale(0);D.alpha=0,L.myStatusBox=RectangleShape({width:100,height:200,fill:"rgba(0, 0, 0, 0.6)",stroke:0}).addChildTo(this).setPosition(this.gridX.span(-2),this.gridY.center(-2)),Label({text:"You",fontSize:20,fontWeight:800,fill:"white"}).addChildTo(L.myStatusBox).setPosition(0,-80);const M=Sprite("defense").addChildTo(L.myStatusBox).setPosition(0,-25),A=Label({text:"",fontSize:40,fontWeight:800,fill:"white",stroke:"black",strokeWidth:2}).addChildTo(M),z=Sprite("life").addChildTo(L.myStatusBox).setPosition(0,50),R=Label({text:"",fontSize:40,fontWeight:800,fill:"white",stroke:"black",strokeWidth:2}).addChildTo(z);e(),L.enemyStatusBox=RectangleShape({width:280,height:80,fill:"rgba(0, 0, 0, 0.6)",stroke:0}).addChildTo(this).setPosition(this.gridX.center(4),this.gridY.span(1)),Label({text:"Enemy",fontSize:20,fontWeight:800,fill:"white"}).addChildTo(L.enemyStatusBox).setPosition(-90,-10);const E=Sprite("defense").addChildTo(L.enemyStatusBox).setPosition(0,0),_=Label({text:"",fontSize:40,fontWeight:800,fill:"white",stroke:"black",strokeWidth:2}).addChildTo(E);_.text="0";const O=Sprite("life").addChildTo(L.enemyStatusBox).setPosition(70,0),F=Label({text:"",fontSize:40,fontWeight:800,fill:"white",stroke:"black",strokeWidth:2}).addChildTo(O);F.text="10",i(),L.enemyActions=[null,null,null],L.layoutCards=[null,null],L.dropArea=RectangleShape({width:310,height:225,fill:"rgba(0, 0, 0, 0.2)",stroke:"yellow",strokeWidth:1}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center()).hide(),L.layoutBox1=RectangleShape({width:140,height:205,fill:"transparent",strokeWidth:0}).addChildTo(this).setPosition(240,this.gridY.center()).hide(),L.layoutBox2=RectangleShape({width:140,height:205,fill:"transparent",strokeWidth:0}).addChildTo(this).setPosition(400,this.gridY.center()).hide();const H=new CardsUI(myCards);H.shuffle(),H.ui.addChildTo(this).setPosition(this.gridX.center(10),this.gridY.center(1));let U=[];const N=new CardsUI(null,!0);N.ui.addChildTo(this).setPosition(this.gridX.center(-10),this.gridY.center(1));const j=new BasicButton({text:"TURN END",width:300,height:70,dark:!0});j.ui.addChildTo(this).setPosition(this.gridX.center(),this.gridY.span(15)).setInteractive(!0).on("pointstart",function(){waiting||C()}).hide(),waiting=!0,t.player.defense=0,setTimeout(function(){W().then(function(){P()})},10)}}),phina.define("CardDetailScene",{superClass:"DisplayScene",init:function(t){this.superInit(t);const e=this;let i,n,a,o;this.backgroundColor="rgba(0,0,0,0.8)",t.button1||t.button2?t.button1&&!t.button2&&(i=700,n=this.gridY.center(-2),a=this.gridY.center(3),o=this.gridY.center(5)):(i=600,n=this.gridY.center(-1),o=this.gridY.center(3.8));RectangleShape({width:500,height:i,fill:"black",stroke:"white",strokeWidth:2,cornerRadius:5,shadow:"white",shadowBlur:10}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center());const s=new Card(t.cardID,!0);if(t.card&&t.card.rawID&&(s.rawID=t.card.rawID),s.ui.addChildTo(this).setPosition(this.gridX.center(),n),t.button1){const i=new BasicButton({width:200,height:50,text:t.button1.text,dark:!0,primary:!0});i.ui.addChildTo(this).setPosition(this.gridX.center(),a),i.ui.setInteractive(!0),i.ui.on("pointstart",function(){t.returnObj&&(t.returnObj.tobeExit=!0),t.button1.callback&&(t.button1.callback(s),e.exit())})}const r=Sprite("close");r.addChildTo(this).setPosition(this.gridX.center(),o),r.clear("pointstart"),r.setInteractive(!0),r.on("pointstart",function(){e.exit()})}}),phina.define("CardPlusScene",{superClass:"DisplayScene",init:function(t){function e(t,e){for(let i=0;i<cardEvolutionRules.length;i++){const n=cardEvolutionRules[i];if(n.in1===t&&n.in2===e||n.in1===e&&n.in2===t)return n.out}return null}this.superInit(t);const i=this;i.backgroundColor="black";const n=Sprite("effect1").addChildTo(this).setPosition(this.gridX.center(),this.gridY.center()).hide();n.alpha=0;let a=null,o=null,s=null,r=null;this.on("resume",function(){a&&(s&&s.ui.remove(),s=new Card(a.id,!0),s.ui.addChildTo(i).setPosition(this.gridX.center(-4),this.gridY.center(-2))),o&&(r&&r.ui.remove(),r=new Card(o.id,!0),r.ui.addChildTo(i).setPosition(this.gridX.center(4),this.gridY.center(-2)))}),i.layoutBox1=RectangleShape({width:270,height:400,fill:"rgba(0, 0, 0, 0.2)",stroke:"yellow",strokeWidth:1}).addChildTo(this).setPosition(this.gridX.center(-4),this.gridY.center(-2)),i.layoutBox1.setInteractive(!0),i.layoutBox1.on("pointstart",function(){App.pushScene(CardsListScene({cards:myCards,button1:{text:"決定",callback:function(t){a=t}},hideFunc:function(t){const e=a?a.rawID:"",i=o?o.rawID:"";return t.rawID===e||t.rawID===i},selectableFunc:function(t){if(null===o){const e=cardEvolutionRules.filter(function(e){return e.in1===t.id||e.in2===t.id});return e.some(function(e){let i=null;if(i=e.in1===t.id?e.in2:e.in1,i===t.id){const e=myCards.list.filter(function(e){return e.id===t.id});return e.length>=2}return myCards.list.some(function(t){return t.id===i})})}return cardEvolutionRules.some(function(e){return e.in1===t.id&&e.in2===o.id||e.in1===o.id&&e.in2===t.id})}}))}),Label({text:"Card1",fill:"yellow"}).addChildTo(i.layoutBox1).setPosition(0,0),i.layoutBox2=RectangleShape({width:270,height:400,fill:"rgba(0, 0, 0, 0.2)",stroke:"yellow",strokeWidth:1}).addChildTo(this).setPosition(this.gridX.center(4),this.gridY.center(-2)),i.layoutBox2.setInteractive(!0),i.layoutBox2.on("pointstart",function(){App.pushScene(CardsListScene({cards:myCards,button1:{text:"決定",callback:function(t){o=t}},hideFunc:function(t){const e=a?a.rawID:"",i=o?o.rawID:"";return t.rawID===e||t.rawID===i},selectableFunc:function(t){if(null===a){const e=cardEvolutionRules.filter(function(e){return e.in1===t.id||e.in2===t.id});return e.some(function(e){let i=null;if(i=e.in1===t.id?e.in2:e.in1,i===t.id){const e=myCards.list.filter(function(e){return e.id===t.id});return e.length>=2}return myCards.list.some(function(t){return t.id===i})})}return cardEvolutionRules.some(function(e){return e.in1===a.id&&e.in2===t.id||e.in1===t.id&&e.in2===a.id})}}))}),Label({text:"Card2",fill:"yellow"}).addChildTo(i.layoutBox2).setPosition(0,0);const l=new BasicButton({width:200,height:80,text:"合成する\n（魔石１消費）",dark:!0,primary:!0});l.ui.addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(4)),l.ui.on("pointstart",function(){function t(){return Flow(function(t){n.show().tweener.to({alpha:1},4e3).call(function(){t()}).play(),s.ui.tweener.to({x:i.gridX.center(-3),alpha:.6},800,"easeInOutBack").to({x:i.gridX.center(-1),alpha:.4},800,"easeInOutBack").to({x:i.gridX.center(),alpha:.2},800,"easeInOutBack").rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).play(),r.ui.tweener.to({x:i.gridX.center(3),alpha:.6},800,"easeInOutBack").to({x:i.gridX.center(1),alpha:.4},800,"easeInOutBack").to({x:i.gridX.center(),alpha:.2},800,"easeInOutBack").rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-4,50).rotateBy(4,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-3,50).rotateBy(3,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-2,50).rotateBy(2,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).rotateBy(-1,50).rotateBy(1,50).play()})}s&&r&&(l.ui.hide(),c.hide(),i.layoutBox1.remove(),i.layoutBox2.remove(),t().then(function(){n.remove();const t=e(s.id,r.id);s.ui.remove(),r.ui.remove();const l=new Card(t,!0);l.ui.addChildTo(i).setPosition(i.gridX.center(),i.gridY.center(-2)),myCards.add(new Card(t)),myCards.remove(a.rawID),myCards.remove(o.rawID),player.stone-=1;const c=Sprite("close");c.addChildTo(i).setPosition(i.gridX.center(),i.gridY.center(5)),c.clear("pointstart"),c.setInteractive(!0),c.on("pointstart",function(){i.exit("MainScene")})}))});const c=Sprite("close");c.addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(7)),c.clear("pointstart"),c.setInteractive(!0),c.on("pointstart",function(){i.exit("MainScene")})}});const cardEvolutionRules=[{in1:"02",in2:"13",out:"20"},{in1:"14",in2:"00",out:"21"},{in1:"01",in2:"12",out:"22"},{in1:"16",in2:"17",out:"23"},{in1:"15",in2:"15",out:"24"},{in1:"05",in2:"06",out:"25"},{in1:"03",in2:"10",out:"26"},{in1:"04",in2:"11",out:"27"},{in1:"26",in2:"27",out:"30"},{in1:"07",in2:"22",out:"31"},{in1:"20",in2:"54",out:"34"},{in1:"25",in2:"25",out:"34"},{in1:"53",in2:"55",out:"35"},{in1:"34",in2:"50",out:"35"},{in1:"25",in2:"11",out:"36"},{in1:"35",in2:"53",out:"37"},{in1:"35",in2:"30",out:"37"},{in1:"37",in2:"56",out:"38"},{in1:"40",in2:"40",out:"41"},{in1:"40",in2:"50",out:"41"},{in1:"21",in2:"55",out:"50"},{in1:"31",in2:"32",out:"51"},{in1:"40",in2:"54",out:"52"},{in1:"54",in2:"52",out:"56"}];phina.define("CardPresenterScene",{superClass:"DisplayScene",init:function(t){function e(){const t=RectangleShape({width:450,height:60,fill:"rgba(0,0,0,0.7)",strokeWidth:0}).addChildTo(o).setPosition(o.gridX.center(),o.gridY.center());Label({text:"「好きな方を持っていきなさい」",fill:"white",fontSize:30}).addChildTo(t).setPosition(0,0),o.on("pointstart",function(){t.remove(),o.clear("pointstart"),i()})}function i(){const e=new Card(t.card1id,!0);e.ui.addChildTo(o).setPosition(o.gridX.center(-4),o.gridY.center()),e.ui.setInteractive(!0),e.ui.on("pointstart",function(){n(e,i).then(function(){a()})});const i=new Card(t.card2id,!0);i.ui.addChildTo(o).setPosition(o.gridX.center(4),o.gridY.center()),i.ui.setInteractive(!0),i.ui.on("pointstart",function(){n(i,e).then(function(){a()})})}function n(t,e){return Flow(function(i){myCards.add(new Card(t.id)),e.ui.remove(),t.ui.tweener.to({x:o.gridX.center()},300).wait(500).to({alpha:0},300).wait(300).call(function(){t.ui.remove(),i()}).play()})}function a(){const t=RectangleShape({width:300,height:60,fill:"rgba(0,0,0,0.7)",strokeWidth:0}).addChildTo(o).setPosition(o.gridX.center(),o.gridY.center());Label({text:"「よい旅を」",fill:"white",fontSize:30}).addChildTo(t).setPosition(0,0),o.on("pointstart",function(){o.exit("MainScene")})}this.superInit(t);const o=this;o.backgroundColor="black";Sprite("npc1").addChildTo(this).setPosition(this.gridX.center(),this.gridY.center());e()}}),phina.define("CardsListScene",{superClass:"DisplayScene",init:function(t){function e(){for(let t=0;t<n.list.length;t++)n.list[t].ui.show(),n.list[t].ui.alpha=1}this.superInit(t);const i=this,n={list:[]};t.cards.list.forEach(function(t){n.list.push(new Card(t.id,!1,t.rawID))}),i.backgroundColor="black";const a=RectangleShape({width:this.width,height:this.height,fill:"black",strokeWidth:0}).addChildTo(i).setOrigin(0,0).setPosition(-5,-5),o=Scrollable().attachTo(a);o.setScrollType("y").enableClip(),o.setMaxY(0),Math.ceil(n.list.length/4)>=4?o.setMinY(-1*Math.ceil(n.list.length/4)*250+a.height-120):o.setMinY(0);const s=DisplayElement().addChildTo(a).setPosition(0,0);let r=1,l=0;for(let e=0;e<n.list.length;e++){if(e%4==0&&(l+=1),r=e%4*150+100,n.list[e].ui.addChildTo(s).setPosition(r,250*l-100),t.hideFunc&&t.hideFunc(n.list[e])){n.list[e].ui.hide();continue}if(n.list[e].ui.show(),t.selectableFunc&&!1===t.selectableFunc(n.list[e])){n.list[e].ui.alpha=.3;continue}let i;n.list[e].ui.setInteractive(!0),n.list[e].ui.on("pointstart",function(t){i=t.pointer.y}),n.list[e].ui.on("pointend",function(a){t.disableCards&&t.disableCards.some(function(t){return n.list[e]===t})||i===a.pointer.y&&App.pushScene(CardDetailScene({card:n.list[e],cardID:n.list[e].id,cardRawId:n.list[e].rawID,button1:t.button1,returnObj:c}))})}const c={};this.on("resume",function(){c.tobeExit&&(e(),i.exit())});const d=Sprite("close");d.addChildTo(this).setPosition(this.gridX.center(),this.gridY.span(15)),d.setInteractive(!0),d.on("pointstart",function(){e(),i.exit()})}}),phina.define("GetItemScene",{superClass:"DisplayScene",init:function(t){this.superInit(t);const e=this;if(e.backgroundColor="black",!t.items)return void setTimeout(function(){e.exit("MainScene")},10);if(Label({text:"入手",fontSize:30,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-5)),t.items.stone&&(Label({text:"魔石 "+t.items.stone+" 個",fontSize:50,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-3)),player.stone+=t.items.stone),t.items.card){const e=new Card(t.items.card);e.ui.addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(t.items.stone?0:-1)),e.ui.setInteractive(!0),e.ui.on("pointstart",function(){App.pushScene(CardDetailScene({card:e,cardID:e.id}))}),myCards.add(e)}const i=Sprite("close");i.addChildTo(this).setPosition(this.gridX.center(),this.gridY.span(13)),i.clear("pointstart"),i.setInteractive(!0),i.on("pointstart",function(){e.exit("MainScene")})}}),phina.define("IntroScene",{superClass:"DisplayScene",init:function(t){this.superInit(t);const e=this;this.backgroundColor="black",Sprite("story").addChildTo(this).setPosition(this.gridX.center(),this.gridY.center());const i=Label({fill:"white",fontSize:30,text:"ここが碁会所というやつか"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-1));i.alpha=0,i.tweener.wait(300).to({alpha:1},300).wait(300).call(function(){const t=new BasicButton({width:200,height:50,text:"中へ入る",dark:!0});t.ui.addChildTo(e).setPosition(e.gridX.center(),e.gridY.center(5)),t.ui.setInteractive(!0),t.ui.on("pointstart",function(){e.exit("MainScene")})}).play()}}),phina.define("MainScene",{superClass:"DisplayScene",init:function(t){function e(t,e){const i=RectangleShape({width:n.width,height:n.height,fill:"black"}).addChildTo(n).setPosition(n.gridX.center(),n.gridY.center());"fadeIn"===t?(i.alpha=1,i.tweener.to({alpha:0},1e3).call(function(){i.remove(),e&&e()}).play()):(i.alpha=0,i.tweener.to({alpha:1},500).call(function(){i.remove(),e&&e()}).play())}function i(){if(a.text){const t=Label({fill:"white",fontSize:30,text:a.text,stroke:"black",strokeWidth:10}).addChildTo(n).setPosition(n.gridX.center(),n.gridY.center(-1));t.alpha=0,t.tweener.wait(300).to({alpha:1},300).play()}}this.superInit(t);const n=this;n.backgroundColor="black";const a=map[mapIndex];if(myCards.count()<4&&myCards.createNewCards(),player.hp>player.maxHp&&(player.hp=player.maxHp),storage.save(),3===a.type)return void setTimeout(function(){App.replaceScene(CardPresenterScene({card1id:a.items.card1,card2id:a.items.card2})),mapIndex+=1},10);let o;if(1===a.type?o="dungeon01":2===a.type?o="dungeon02":9!==a.type&&10!==a.type||(o="dungeon09"),Sprite(o).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center()),LabelArea({width:200,height:80,text:a.floor,fontSize:50,fill:"white",align:"right"}).addChildTo(this).setPosition(this.gridX.span(13),this.gridY.span(1)),LabelArea({width:200,height:80,text:"ＨＰ: "+player.hp+" / "+player.maxHp,fontSize:30,fill:"white"}).addChildTo(this).setPosition(this.gridX.span(3),this.gridY.span(1)),LabelArea({width:200,height:80,text:"魔石: "+player.stone,fontSize:30,fill:"white"}).addChildTo(this).setPosition(this.gridX.span(3),this.gridY.span(1.7)),player.stone>=1&&10!==a.type){const t=RectangleShape({width:80,height:60,fill:"rgba(0,0,0,0.8)",stroke:"white",strokeWidth:3,cornerRadius:5}).addChildTo(this).setPosition(this.gridX.span(2),this.gridY.span(4.4));Label({text:"合成",fill:"white",fontSize:23}).addChildTo(t),t.setInteractive(!0),t.on("pointstart",function(){n.exit("CardPlusScene")});const e=RectangleShape({width:t.width,height:t.height,fill:"yellow",strokeWidth:0,cornerRadius:5}).hide().addChildTo(t);e.alpha=0,e.show().tweener.wait(500).to({alpha:.7,width:t.width,height:t.height},100).to({alpha:0,width:t.width+20,height:t.height+20},500,"easeOutCirc").to({alpha:.7,width:t.width,height:t.height},100).to({alpha:0,width:t.width+20,height:t.height+20},500,"easeOutCirc").call(function(){e.remove()}).play()}if(10!==a.type){const t=new CardsUI(myCards);t.ui.addChildTo(this).setPosition(this.gridX.span(2),this.gridY.span(2.7))}if(1===a.type||9===a.type){i();const t=new BasicButton({width:200,height:50,text:"９階"===a.floor?"席亭を探す":"奥へ進む",dark:!0});t.ui.addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(5)),t.ui.on("pointstart",function(){if(mapIndex+=1,a.enemy){storage.remove();const t=new Enemy(a.enemy);n.exit("BattleScene",{player:player,enemy:t,items:a.items,backImage:o})}else e("fadeOut",function(){App.replaceScene(MainScene())})}),e("fadeIn")}if(2===a.type){i();const t=new BasicButton({width:200,height:50,text:"階段を上る",dark:!0});t.ui.addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(5)),t.ui.on("pointstart",function(){mapIndex+=1,e("fadeOut",function(){App.replaceScene(MainScene())})}),e("fadeIn")}if(10===a.type){Label({fill:"white",fontSize:150,text:"GAME\nCLEAR",fontWeight:800,stroke:"black",strokeWidth:2}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-1));Label({fill:"white",fontSize:30,text:"最後まで遊んでいただき\nありがとうございました。",fontWeight:800,stroke:"black",strokeWidth:2}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(4)),this.on("pointstart",function(){n.exit("ResultScene")})}}});const map=[{floor:"１階",type:1,enemy:"01",text:"…誰かいますか",items:null},{floor:"１階",type:1,enemy:"02",text:"",items:{card:"11"}},{floor:"１階",type:1,enemy:"01",text:"",items:{card:"07"}},{floor:"１階",type:1,enemy:"02",text:"",items:{stone:1,card:"15"}},{floor:"１階",type:1,enemy:null,text:"",items:null},{floor:"１階",type:3,enemy:null,items:{card1:"07",card2:"40"}},{floor:"１階",type:1,enemy:"01",text:"",items:{stone:1}},{floor:"１階",type:2,enemy:null,text:"",items:null},{floor:"２階",type:1,enemy:"03",text:"",items:{card:"32"}},{floor:"２階",type:1,enemy:"04",text:"",items:{stone:1}},{floor:"２階",type:1,enemy:"03",text:"",items:{stone:1,card:"03"}},{floor:"２階",type:1,enemy:"04",text:"",items:{stone:1,card:"10"}},{floor:"２階",type:1,enemy:null,text:"",items:null},{floor:"２階",type:3,enemy:null,items:{card1:"50",card2:"40"}},{floor:"２階",type:1,enemy:"03",text:"",items:{stone:1,card:"20"}},{floor:"２階",type:1,enemy:"04",text:"",items:{stone:1}},{floor:"２階",type:2,enemy:null,text:"",items:null},{floor:"３階",type:1,enemy:"05",text:"",items:{stone:1}},{floor:"３階",type:1,enemy:"06",text:"",items:{stone:1,card:"04"}},{floor:"３階",type:1,enemy:"05",text:"",items:{stone:1,card:"17"}},{floor:"３階",type:1,enemy:"06",text:"",items:null},{floor:"３階",type:1,enemy:"05",text:"",items:{card:"55"}},{floor:"３階",type:2,enemy:null,text:"",items:null},{floor:"４階",type:1,enemy:"07",text:"",items:{stone:1,card:"05"}},{floor:"４階",type:1,enemy:null,text:"",items:null},{floor:"４階",type:3,enemy:null,items:{card1:"55",card2:"40"}},{floor:"４階",type:1,enemy:"08",text:"",items:{stone:1}},{floor:"４階",type:1,enemy:"07",items:{card:"16"}},{floor:"４階",type:1,enemy:"08",items:{stone:1,card:"57"}},{floor:"４階",type:1,enemy:null,items:null},{floor:"４階",type:3,enemy:null,items:{card1:"53",card2:"54"}},{floor:"４階",type:2,enemy:null,items:null},{floor:"５階",type:1,enemy:"09",text:"",items:null},{floor:"５階",type:1,enemy:"10",items:{card:"06"}},{floor:"５階",type:1,enemy:"09",items:{stone:1}},{floor:"５階",type:1,enemy:null,items:null},{floor:"５階",type:3,enemy:null,items:{card1:"57",card2:"58"}},{floor:"５階",type:1,enemy:"09",items:null},{floor:"５階",type:1,enemy:"10",items:{stone:1}},{floor:"５階",type:2,enemy:null,items:null},{floor:"６階",type:1,enemy:"11",text:"",items:null},{floor:"６階",type:1,enemy:"12",items:{card:"20"}},{floor:"６階",type:1,enemy:"11",items:{stone:1}},{floor:"６階",type:1,enemy:null,items:null},{floor:"６階",type:3,enemy:null,items:{card1:"54",card2:"33"}},{floor:"６階",type:1,enemy:"11",items:null},{floor:"６階",type:1,enemy:"12",items:null},{floor:"６階",type:2,enemy:null,items:null},{floor:"７階",type:1,enemy:"13",text:"",items:null},{floor:"７階",type:1,enemy:"14",items:{card:"27"}},{floor:"７階",type:1,enemy:"13",items:{stone:1}},{floor:"７階",type:1,enemy:null,items:null},{floor:"７階",type:3,enemy:null,items:{card1:"26",card2:"31"}},{floor:"７階",type:1,enemy:"13",items:{stone:1}},{floor:"７階",type:1,enemy:"14",items:null},{floor:"７階",type:2,enemy:null,items:null},{floor:"８階",type:1,enemy:"15",text:"",items:null},{floor:"８階",type:3,enemy:null,items:{card1:"53",card2:"54"}},{floor:"８階",type:1,enemy:"16",items:{stone:1,card:"35"}},{floor:"８階",type:1,enemy:"17",items:null},{floor:"８階",type:1,enemy:"16",items:null},{floor:"８階",type:1,enemy:"17",items:{stone:1}},{floor:"８階",type:2,enemy:null,items:null},{floor:"９階",type:9,enemy:"99",text:"…行き止まりだ",items:null},{floor:"９階",type:10,enemy:null,items:null}];phina.define("ResultScene",{superClass:"DisplayScene",init:function(t){this.superInit(t);const e=this;this.backgroundColor="black";const i=Sprite("dungeon01").addChildTo(this).setPosition(this.gridX.center(),this.gridY.center());i.alpha=.2;const n=RectangleShape({width:this.width,height:this.height,fill:"transparent",strokeWidth:0}).addChildTo(this).setPosition(0,0).setOrigin(0,0);n.alpha=0,Label({text:"RECORD",fontSize:40,fill:"white"}).addChildTo(n).setPosition(this.gridX.center(),this.gridY.center(-7)),LabelArea({width:this.width-100,height:80,text:"到達階",fontSize:30,fill:"white"}).addChildTo(n).setPosition(this.gridX.center(),this.gridY.center(-5)),LabelArea({width:200,height:80,text:map[mapIndex].floor,fontSize:30,fontWeight:800,fill:"white"}).addChildTo(n).setPosition(this.gridX.center(),this.gridY.center(-5)),LabelArea({width:this.width-100,height:80,text:"所有カード",fontSize:30,fill:"white"}).addChildTo(n).setPosition(this.gridX.center(),this.gridY.center(-4)),myCards.list.toSorted((t,e)=>t.title>e.title?1:-1).forEach((t,e)=>{const i=e%3==0?-3:e%3==1?2:7,a=3*Math.floor(e/3);LabelArea({width:(this.width-100)/2,height:80,text:t.title.replaceAll("\n",""),fontSize:25,fill:"white"}).addChildTo(n).setPosition(this.gridX.center(i),this.gridY.center(.2*a-3))});const a=Sprite("close");a.addChildTo(n).setPosition(this.gridX.center(),this.gridY.center(7)),a.clear("pointstart"),a.setInteractive(!0),a.on("pointstart",function(){n.tweener.to({alpha:0},500).call(function(){n.remove(),o.show(),o.tweener.to({alpha:1},500).play()}).play()}),n.tweener.to({alpha:1},500).play();const o=RectangleShape({width:this.width,height:this.height,fill:"transparent",strokeWidth:0}).addChildTo(this).setPosition(0,0).setOrigin(0,0);o.alpha=0,o.hide(),LabelArea({width:500,height:100,text:"今回のカードの中から１枚を選んで\n次回のプレイで使用できます。",fontSize:30,fill:"white"}).addChildTo(o).setPosition(this.gridX.center(),this.gridY.center(-2));const s=new BasicButton({text:"カード選択",width:200,height:60,dark:!0}).ui.addChildTo(o).setPosition(this.gridX.center(),this.gridY.center());s.on("pointstart",function(){App.pushScene(CardsListScene({cards:myCards,button1:{text:"決定",callback:function(t){r=t}}}))});let r=null;this.on("resume",function(){if(r){o.remove();const t=new Card(r.id,!0);t.ui.addChildTo(e).setPosition(e.gridX.center(),e.gridY.center()),localStorage.setItem("card",JSON.stringify({takeOver:{cardID:r.id}})),t.ui.tweener.wait(200).to({scaleX:0,scaleY:0,alpha:0},1e3,"easeInExpo").call(function(){e.exit("TitleScene")}).play()}})}}),phina.define("Scrollable",{superClass:"phina.accessory.Accessory",scrollType:"normal",vx:0,vy:0,minX:-1/0,minY:-1/0,maxX:1/0,maxY:1/0,_locked:!1,init:function(t){this.superInit(t),this.friction=.8,this.on("attached",this._attached)},lock:function(){return this._locked=!0,this.vx=this.vy=0,this},unlock:function(){return this._locked=!1,this},setFriction:function(t){return this.friction=t,this},setScrollType:function(t){return this.scrollType=t,this},setMaxX:function(t){return this.maxX=t,this},setMinX:function(t){return this.minX=t,this},setMaxY:function(t){return this.maxY=t,this},setMinY:function(t){return this.minY=t,this},setMaxPosition:function(t,e){return this.maxX=t,this.maxY=e,this},setMinPosition:function(t,e){return this.minX=t,this.minY=e,this},enableClip:function(){return this.target.clip=function(t){var e=this.width,i=this.height;t.beginPath().rect(-e*this.originX,-i*this.originY,e,i)},this},disableClip:function(){return this.target.clip=null,this},_attached:function(t){var e=this.target;e.setInteractive(!0),this._setPointstart(),this._setPointmove(),this._setPointend(),this._setEnterframe()},
_setPointstart:function(){var t=this;this.target.on("pointstart",function(e){t.pointing=!0})},_setPointmove:function(){var t=this;this.target.on("pointmove",function(e){t._locked||t.getScrollMethod().move.call(this,e,t)})},_setPointend:function(){var t=this;this.target.on("pointend",function(e){t.pointing=!1,t._locked||(t.vx=e.pointer.fx,t.vy=e.pointer.fy)})},_setEnterframe:function(){var t=this;this.target.on("enterframe",function(e){t._locked||!1===t.pointing&&t.getScrollMethod().update(t)},this)},getScrollMethod:function(){return Scrollable.SCROLL_METHOD_MAP[this.scrollType]||Scrollable.SCROLL_METHOD_MAP.normal},_static:{SCROLL_METHOD_MAP:{x:{move:function(t,e){var i=t.pointer.dx,n=e.maxX,a=e.minX;this.children.forEach(function(t){t.x+=i,t.x>n&&(t.x=n),t.x<a&&(t.x=a)})},update:function(t){var e=t.target;t.vx*=t.friction,Math.abs(t.vx)<1&&(t.vx=0);var i=t.vx,n=t.maxX,a=t.minX;e.children.forEach(function(t){t.x+=i,t.x>n&&(t.x=n),t.x<a&&(t.x=a)})}},y:{move:function(t,e){var i=t.pointer.dy,n=e.maxY,a=e.minY;this.children.forEach(function(t){t.y+=i,t.y>n&&(t.y=n),t.y<a&&(t.y=a)})},update:function(t){var e=t.target;t.vy*=t.friction,Math.abs(t.vy)<1&&(t.vy=0);var i=t.vy,n=t.maxY,a=t.minY;e.children.forEach(function(t){t.y+=i,t.y>n&&(t.y=n),t.y<a&&(t.y=a)})}},normal:{move:function(t,e){var i=t.pointer,n=Math.abs(i.dx)<Math.abs(i.dy)?"y":"x",a=i["d"+n],o=e["max"+n.toUpperCase()],s=e["min"+n.toUpperCase()];this.children.forEach(function(t){t[n]+=a,t[n]>o&&(t[n]=o),t[n]<s&&(t[n]=s)})},update:function(t){var e=Math.abs(t.vx)<Math.abs(t.vy)?"y":"x",i="v"+e,n=t.target;t[i]*=t.friction,Math.abs(t[i])<1&&(t[i]=0);var a=t[i],o=t["max"+e.toUpperCase()],s=t["min"+e.toUpperCase()];n.children.forEach(function(t){t[e]+=a,t[e]>o&&(t[e]=o),t[e]<s&&(t[e]=s)}),t.vx=t.vy=0,t[i]=a}},flick:{move:function(t,e){var i={x:t.pointer.dx,y:t.pointer.dy},n=e.maxX,a=e.maxY,o=e.minX,s=e.minY;this.children.forEach(function(t){t.position.add(i),t.x>n&&(t.x=n),t.x<o&&(t.x=o),t.y>a&&(t.y=a),t.y<s&&(t.y=s)})},update:function(t){var e=t.target;t.vx*=t.friction,t.vy*=t.friction,Math.abs(t.vx)<1&&(t.vx=0),Math.abs(t.vy)<1&&(t.vy=0);var i={x:t.vx,y:t.vy},n=t.maxX,a=t.maxY,o=t.minX,s=t.minY;e.children.forEach(function(t){t.position.add(i),t.x>n&&(t.x=n),t.x<o&&(t.x=o),t.y>a&&(t.y=a),t.y<s&&(t.y=s)})}}}}});const storage=new Storage;phina.define("TitleScene",{superClass:"DisplayScene",init:function(t){this.superInit(t);const e=this;this.backgroundColor="black",player=new Player,myCards=new Cards,mapIndex=0,Label({text:"囲碁を知らなくても遊べるカードゲーム",fontSize:20,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-2)),Label({text:"格闘囲碁",fontSize:100,fontWeight:800,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(-3)),Label({text:"ver. "+version,fontSize:18,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(3.8),this.gridY.center(-1.5)),Label({text:"TAP TO START",fontSize:30,fontWeight:800,fill:"white"}).addChildTo(this).setPosition(this.gridX.center(),this.gridY.center(3)),this.on("pointstart",function(){0===mapIndex?e.exit("IntroScene"):e.exit("MainScene")}),storage.load()}});
